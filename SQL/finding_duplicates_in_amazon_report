-- create table to fill with data from text file, left all data-types as text because just looking for duplicates

CREATE TABLE amazon_listings_report_07262024 (
	item_name text,
	item_description text,
	listing_id text,
	seller_sku text,
	price text,
	quantity text,
	open_date text,
	image_url text,
	item_is_marketplace text,
	product_id_type text,
	zshop_shipping_fee text,
	item_note text,
	item_condition text,
	zshop_category1 text,
	zshop_browse_path text,
	zshop_storefront_feature text,
	asin1 text,
	asin2 text,
	asin3 text,
	will_ship_internationally text,
	expedited_shipping text,	
	zshop_boldface text,
	product_id text,
	bid_for_featured_placement text,
	add_delete text,
	pending_quantity text,
	fulfillment_channel text,
	merchant_shipping_group text,
	status text
	);

--filled table with data from text file
COPY public.amazon_listings_report_07262024
FROM 'C:\Users\Public\All+Listings+Report+07-26-2024.txt'
DELIMITER '	'
CSV HEADER;

--preliminary check of data to ensure it was copied from text file correctly and column titles are correct
SELECT *
FROM public.amazon_listings_report_07262024
LIMIT 10;

--check count to see if makes sense (it did not), raised question 
SELECT COUNT(*)
FROM public.amazon_listings_report_07262024;

--generated and then exported list of duplicated items (108 results)
COPY
	(SELECT item_name, COUNT(item_name)
	FROM public.amazon_listings_report_07262024
	GROUP BY item_name
	HAVING COUNT(item_name) > 1
	ORDER BY COUNT(item_name) DESC)
TO 'C:\Users\Public\DuplicateAmazonListings07262024.txt';

--generated and then exported sample duplicate result
COPY
	(SELECT *
	FROM public.amazon_listings_report_07262024
	WHERE item_name LIKE 'Bussmann FRS-R-100 100 Amp Fusetron Dual Element Time-Delay Current Limiting Class RK5 Fuse, 600V UL Listed,Black')
TO 'C:\Users\Public\EXAMPLEduplicatelisting.txt'
HEADER;
